## CTF: Forensics AY25
Challenge: Operation Oni 

Category:  forensics

Points:

Difficulty: Intermediate

## Instructions

Download this disk image, find the key and log into the remote machine.  
Note: if you are using the webshell, download and extract the disk image into /tmp not your home directory.  
Download disk image  
Remote machine: ssh -i key_file -p 51697 ctf-player@saturn.picoctf.net

## Solution
Need to log onto the ssh using the given ssh
* read the strings of the files with a few different greps
* password - alot of stuff
* key - alot of stuff
* ctf-player - nothing
* saturn.pico.ctf.net - nothing 
* /etc/ssh - something interseting 
>  if [ ! -e /etc/ssh/ssh_host_key ]; then
        ebegin "Generating Hostkey"
        ssh-keygen -t rsa1 -b 1024 -f /etc/ssh/ssh_host_key -N ''
        eend $? || return 1
  if [ ! -e /etc/ssh/ssh_host_dsa_key ]; then
        ebegin "Generating DSA Hostkey"
        ssh-keygen -d -f /etc/ssh/ssh_host_dsa_key -N ''
        eend $? || return 1
  if [ ! -e /etc/ssh/ssh_host_rsa_key ]; then
        ebegin "Generating RSA Hostkey"
        ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key -N ''
        eend $? || return 1

>  you can generate a SHA512 password using: mkpasswd
* got nothing when looking at them but looked into /root and found

        rm -f /etc/runlevels/*/$RC_SVCNAME
        init_KOPT
        local rc=0
        ebegin "Starting ${RC_SVCNAME}"
        if [ -n "$KOPT_ssh_key" ] && [ ! -f "/root/.ssh/authorized_keys" ]; then
                einfo "Fetching ssh keys"
                mkdir -pm 700 /root/.ssh
                checkpath -fm 0600 /root/.ssh/authorized_keys
                case "$KOPT_ssh_key" in
                        https://*|ftps://*|http://*)
                                wget -q "$KOPT_ssh_key" -O /root/.ssh/authorized_keys
                                rc=$?;;
                        *) echo "$KOPT_ssh_key" > /root/.ssh/authorized_keys;;
                esac
        eend $rc

Looking at the strings I found nothing of insterest 

Decided to mount the disk instead 
* get the disk partitions:

         diskf -l disk.img

        Disk disk.img: 230 MiB, 241172480 bytes, 471040 sectors                                                            
        Units: sectors of 1 * 512 = 512 bytes                                                                              
        Sector size (logical/physical): 512 bytes / 512 bytes                                                              
        I/O size (minimum/optimal): 512 bytes / 512 bytes                                                                  
        Disklabel type: dos
        Disk identifier: 0x0b0051d0

        Device     Boot  Start    End Sectors  Size Id Type
        disk.img1  *      2048 206847  204800  100M 83 Linux
        disk.img2       206848 471039  264192  129M 83 Linux

* Then mont  

         sudo mount -o loop,offset=1048576 disk.img /mnt/disk

* When looking at the data in /mnt/disk i could find nothing of value 

* Try something new so i did: 

        binwalk disk.img

This gave me a [direcoty](_disk.img.extracted) with all the extracted files

* Here I found all the basic root directory ie. usr, bin, etc...

From here I looked into  [/ect/ssh/](https://gitlab.usna.edu/cyberopsmidncourses/sy421/ay-2025-fall/zehnder/-/tree/main/forensics/forensics06/_disk.img.extracted/ext-root-0/etc/ssh)
* In this directory I found all the ssh keys 
* I copied over the ssh_host_rsa_key to [key_file](key_file)  

That key did not work 
* looking for more information I found it talking about only accepting keys from .ssh

So looked for .ssh using   

        find . -iname *ssh  
        ./root/.ssh
        ./etc/ssh
        ./usr/lib/ssh
        ./usr/bin/ssh

So I am trying the [key](key_file) in /root/.ssh

This worked an logged me in with the flat.txt file in it this gave me the flag  
- 
picoCTF{k3y_5l3u7h_af277f77}
## Flag

picoCTF{k3y_5l3u7h_af277f77}

## Mitigation
A mitigation for this would to not use the default ssh keys that are built into the disk. If the disks are public knowledge than anyone would be able to ssh into the system. 
